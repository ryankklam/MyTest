# Ali Cloud

##SLB - Server Load Balancer 

1. server certificate 一次只能上传一份服务器证书及对应的私钥

####SLB功能架构
1. Load Balancer - 代表SLB实例
2. Listener - 代表定制的策略和转发规则
3. Backend Server - 后端的一组云服务器

####SLB基础架构
1. 四层负载均衡 - TCP/UDP
2. 七层负载均衡 - http/https
3. 控制系统 - 配置/监控 负载均衡系统

####SLB主要功能
1. 四层负载均衡/七层负载均衡 - 支持公网及私网（私网免费使用）
2. 健康检查 - 屏蔽不健康的实例，待实例恢复正常解除屏蔽
3. 会话保持 - session生命周期内，统一客户端的请求都转发到同一ECS
4. 转发方式 - 轮询（依次发送）/加权轮询（可为后端ecs设置权重）/加权最小连接数（请求转发到连接数最少的ecs） / 一致性哈希（源IP-相同的原地址会指向同一ECS/四元组-源IP，目的ip，源端口，目标端口，相同的流会指向同一ECS）
5. 证书管理 - https的证书解密放在SLB上，降低ECS的开销
6. 带宽控制 - 根据监听设置对应服务的带宽峰值
7. 容灾 - 支持同一地域（region）跨可用区容灾，结合DNS轮询支持跨地域的容灾
8. 控制方式 - 控制台/api/sdk
* 关于SLB转发规则错误的是 （D 默认有内网先走内网，无再走外网）
* 负载均衡SLB可以通过配置 （A 主机头）来实现对同一ECS不同站点的健康检查
* 峰值为10m的负载均衡实例，监听A峰值设置为4M，监听BC没有设置峰值，如果监听AC一直没有流量进入，则（A 监听B最多只能跑满6M）
* SLB判断流量转发的顺序 （A 先判断是否能匹配到某条“转发规则”，如果匹配，则将流量转发到该规则的后端服务器上）
* 发现某段时间客户端延迟，想要定位异常的后端服务器，推荐其采用的形式是 （C 结合阿里云日志 通过负载均衡巡检 分析负载均衡的响应时间）
* 针对4层服务协议，SLB通过（A 端口检查是否超时）来判断云服务器ecs是否可用
* LVS集群内的每台LVS通过（B 组播报文）将会话同步到集群内其他LVS，从而实现LVS集群内各机器间的会话同步
* 访问SLB99端口能够登录FTP 但读取目录失败，导致错误的关键原因是（D 负载均衡不支持搭建FTP服务）
* A 七层服务可以关闭健康检查, 4层服务不能关闭健康检查

####SLB费用
1. 计费模式 - 预付费（按带宽，只支持升级,不支持降级或者释放）/后付费 （按固定带宽/按流量），可随时释放
2. 总费用 - 实例配置费 + 公网带宽费
3. 公网SLB和ECS之间的流量费 - 不收取费用


####监听概述
#####TCP监听
1. 面向连接的协议，在正式收发数据前，必须和对方建立可靠的连接
2. 基于源地址的会话保持
3. 在网络层可直接看到来源地址
4. 数据传输快
5. 适用于注重可靠性，对数据准确性要求高，速度可以相对较慢的场景，如文件传输、发送或接收邮件、远程登录
6. 无特殊要求的Web应用 （web应用都是基于http/https的）
7. TCP监听 - 支持tcp及http两种方式进行健康检查
8. 只有TCP/UDP监听支持添加主备服务器组
* 关于主备服务器组支持的协议，以下说法正确的是（A 主备服务器组只支持4层监听 TCP/UDP）

#####UDP
1. 面向非连接的协议，在数据发送前不与对方进行三次握手，直接进行数据包发送，不提供差错恢复和数据重传 
2. 可靠性相对低；数据传输快
3. 关注实时性而相对不注重可靠性的场景，如视频聊天、金融实时行情推送

#####HTTP
1. 应用层协议，主要解决如何包装数据
2. 基于Cookie的会话保持
3. 使用X-Forward-For获取源地址
4. 需要对数据内容进行识别的应用，如Web应用、小的手机游戏等。

#####HTTPS
1. 加密传输数据，可以阻止未经授权的访问
2. 统一的证书管理服务，用户可以将证书上传到负载均衡，解密操作直接在负载均衡上完成
3. 需要加密传输的应用。

#####SLB监听超时时间
1. TCP - 900秒
2. UDP - 90秒
3. HTTP - 60秒
4. HTTPS - 60秒


##ECS - Elastic Compute Service 
* ECS支持切换交换机 但不支持切换路由器
* ECS上停止是走正常关机流程，而强制停止则等于断电处理，可能会丢失信息
* ECS管理控制台直接支持的功能不包括 迁移实例
* ECS在更换系统盘的时候，镜像是可以修改的
* ECS转备用状态，则负载均衡不会有流量到，弹性伸缩不会检查此ecs，但也不会释放这个ecs
* ECS转保护状态，则弹性伸缩不会移除这个ECS，负载均衡权重不变（有流量到），弹性伸缩页不会检查此ecs，但也不会释放这个ecs
* VNC方式登录 1：实例自检原因导致启动速度慢 2：误操作开启了防火墙 3：ecs cpu带宽消耗高 。 不包括 （B 忘记SSH密码 无法通过远程工具连接ECS）
* ecs部署sql server，因为windows的单通道i/o特性，最推荐使用是（C. ESSD云盘）
* 更换系统盘后，旧系统盘会被释放，系统盘id会更新，自动快照策略不一定失效
* 扩容系统盘需要ECS停机，但不会导致实力IP的变化
* 查看某个区域所有可用的ecs的实例步骤包括 （B{a,c,b}  进入管理控制台/选择ecs实例管理/选择地域）
* 在使用ecs的过程中，（A 修改上层应用的网络协议）一定不会导致ecs出现异常
* ECS实例的使用中，要创建新的安全组规则时，不可以规定 （C Mac）类型的授权
* 关于云ecs服务器实例快照 说法错误的是 （B 可以保留用户的快照到用户自己的oss bucket中）
* 在windows的ecs选择数据盘，在登录实例后你需要 （A 格式化数据盘）才可以正常使用该数据盘
* 阿里云上恢复误删数据有多种方式，其中不包括 （B 通过ecs控制台恢复该磁盘对应的数据库副本）
* 关于阿里云ecs可用区正确的说法是 （A 可用区是在用户购买时指定的，购买后不支持更改）
* 共享性实例有可用性SLA保证，无性能SLA保证
* 因为业务需要缩短快照的制作时间，可以选择（B 本地快照） ， 快速，秒级别
* 下列选项中 （A 密码）不属于实例启动模板可包含的配置信息  ， 密码是在镜像设置

查看某个区域所拥有的ecs实例
1. 进入ecs控制台
2. 选择ecs实例管理
3. 选择地域



##OSS

* 单个object的大小为48.8TB , 每个bucket的容量无上限
* oss域名绑定（CNAME）仅支持3级域名 （bucket name）。（region）。aliyuncs。com
* 域名绑定必须在工信部备案，不是在阿里云备案
* oss提供3重备份(每份数据备份三个副本)，出故障时自动恢复
* Bucket属性设置 1) 防盗链 2)自定义域名绑定 3) 读写权限（ACL）设置
* OSS的问题不支持修改
* CDN缓存刷新 1）目录刷新 2）URL预热 3） URL刷新
* 将bucket设置成静态网页托管模式后，对静态网站域名的匿名访问 oss将返回索引页；对静态网站根域名的访问 oss将返回GetBucket结果
* OSS同城冗余能够提供机房级别的容灾能力
* OSS低频访问类型存放是平均每月访问1-2次的数据，归档存储类型是放每年访问1-2次的数据
* OSS开启原图保护后，匿名访问不了，但通过CDN的请求可能可以访问（答案选CDN）
* OSS传输和加速服务，可以提升多地域上传速度 （CDN仅加速下载）（答案选A 开启OSS传输和加速服务）
* OSS图片样式，多参数之间用正斜线(/)连接 - 答案选B
* Object的权限大于Bucket的权限 - 若bucket访问私有，object是公共读写，那么 (A.所有用户都有该object的读写权限)
* Bucket自动生成包含日期的object，最可能的原因是 （C. bucket开启了日志存储）
* 公司限制员工只能访问某个指定的公网IP，但oss的bucket访问ip会随时变换，建议其采用 （B. 在ecs配置反向代理）
* 以下不属于精准防护的字段是 （D. Source-address）
* OSS的基本单位是object，object包含key/meta/data,不包含那个元素（B - id）
* OSS基于（A 纠错码）技术的冗余机制，确保硬件丢失时的可靠性可用性
* CDN加速访问url时，页面空白，用开发者工具查看ContentLength为0 ， 原因是 （D 查看源站是否返回了 transferEncoding： chunked 信息，CDN不支持此信息）
* OSS api中通过（D - copy object）参数的操作可以实现设置object头
* 如果想配置OSS设置只允许几个有限的ip访问，可以通过（B ， oss本身没有ip黑白名单功能，可以先使用CDN加速，然后在CDN上配置白名单）
* OSS api请求费用的付费方式支持 （B 只有按量付费）
* 直接在浏览器访问OSS的文件，均限制以“另存为”的形式打开文件，若需要直接在浏览器打开文件，则需要 （B 绑定用户自定义的域名 可以是三级域名）
* 符合存储空间命名规范的是 （A 12-test）， 
* ossutil是命令行工具，不是图形化界面
* OSS只有公网下载才会产生流量费，内网不会产生流量费
* 


##VPC
* 只有两种状态 available （创建成功）/running （配置中）
* 服务器迁移到同vpc下的同一交换机步骤 （C 1，3，2，4）  打开控制台/选择所需交换机并指定新ip/找需要迁移的ecs/指定ecs的私网地址
* ecsAPI 网址 ecs.aliyuncs.com
* 不能开启networkmanager服务
* ecs api默认返回格式为xml
* VPC中的ECS不能与经典网络的ecs实现高速通信
* 某个VPC的网络附加ipv4是172.16.0.0/16，那么该vpc的交换机可选网段为172.16.0.0/17 - 172.16.0.0/29
* 网络ACL的规则是无状态的
* 网络ACL无任何规则时，拒绝所有出入访问 （D）、
* 硅谷和上海分别设置VPC1/VPC2，现想全互通（日流量100m），最高效经济是（B 使用vpn连接办公地点与所在VPC，将两个vpc加载到同一个云企业网）
* VPC默认是没有公网服务的，若想使vpc与公网联通，可以选择 （B. NAT网关）
* ipv6配置顺序 分配IPv6地址/开通网络带宽/配置v6地址/添加安全组规则 （B 2-1-4-3）
* ipv6类型的SLB可以关联ipv4的ECS
* 使用隧道封装技术对云服务的ip报文进行封装，所有云服务器的 （B 数据链路层 即二层mac地址） 信息不会进入物理网络，实现了不同云服务器之间的网络隔离
* 希望VPC下的ECS通过内网访问OSS，但是连接oss-cn-beijing-internal。aliyuncs.com失败，则 （A 只能通过外网访问）
* 安全组内网络隔离是网卡之间的隔离，不是ecs之间的隔离
* 创建VPC后，系统会自动添加一条以（C 100.64.0.0、10）为目标网段的路由条目，用于云产品的通讯
* 同一专有网络不同交换机下的子网内网互通

##ESS弹性伸缩
* 弹性自愈 - 就是（B 如果伸缩组某台ecs不是运行中，则该ecs会被移出伸缩组，同时自动创建一台新的ecs添加进伸缩组）
* 伸缩组包含 1）伸缩配置 2）伸缩规则 3） 伸缩活动
* 伸缩规则定义了具体的扩展或收缩工作 如 （A 加入或移除3个云服务的ECS实例）
* 使用伸缩组内的实例配置信息自动创建ECS，实力配置信息支持实例的规格，用户自定义数据及 （A 操作系统）
* 伸缩活动不可中断
* 在冷却时间内，伸缩组会拒绝由云监控发起的伸缩活动请求，对其他的类型的任务则会立即执行，绕过冷却时间
* 弹性伸缩生命周期挂钩支持的配置方式不包括OSS主板 
* 假设在某一时间点，定时任务和报警任务同时满足执行条件，以下说法正确的是 （B 同时只会有一个伸缩任务执行，两种任务并没有优先级之分）
* 弹性伸缩不依赖任何其他产品
* 如果多个定时在同一时间触发任务，则（A 会选取最近创建的定时任务执行，排在后面的定时任务会在LaunchExpirationTime内自动触发重试 ）
* 每两次触发该报警任务的时间间隔最少为=周期*重复次数 （C 6分钟）
* （A 定时任务）不依赖于伸缩组的生命周期，即不会随着伸缩组的删除而删除
* 出于安全考虑要限制某台绑定EIP的ecs的3389远程端口的访问，可以通过（A 安全组规则添加一条内网规则，拒绝tcp协议来自3389端口的入方向访问，注意）
* （C 每秒新增查询数） 不属于性能保障性实例的关键指标
* 判断ECS实例状态/分配activity id,执行伸缩活动 /加入ECS实例 / 修改total capacity  （A   A-B-D-C）




##Points

交换机（VSwitch）不支持组播和广播


某个VPC的网络附加ipv4是172.16.0.0/16，那么该vpc的交换机可选网段为172.16.0.0/17 - 172.16.0.0/29
网络ACL的规则是无状态的
网络ACL无任何规则时，拒绝所有出入访问 （D）
SLB后端的ecs操作系统不一定需要一致
CDN实际产生的流量比应用层统计到的要高。是两个原因 1： TCP/IP的包头的消耗 2：TCP重传
创建EIP之后，云监控服务自动开启

公网分发请求到SLB的方法 1：购买公网ip的负载均衡SLB实例接受公网请求 2：创建VPC内的负载均衡实例，然后给这个SLB绑定EIP来接收公网请求
* 安全管家 支持人工安全技术支持，托管报告服务
* 安骑士 可以检测并修复漏洞
* 安装安骑士客户端后，用（A 管理控制台生成的安装验证key 方式与指定的阿里云账号互联）
云盾DDos是保障ECS/SLB/WAF/VPC/EIP/NAT云产品的网络安全，并不包括RDS/OSS
阿里云会保存SSH key的公钥部分
弹性公网IP（EIP）秒级监控
弹性公网IP说法错误的是 （A 只能绑定在同一地域的特定可用区的VPC的ecs上）

SLB的虚拟服务器组如果添加了该ecs，该ecs从经典网络迁移到vpc时，实例不会自动挂载
本地盘，很多操作都不行

HTTPDNS主要用在客户端防止url域名挟持
云态势感知，可以通过手机短讯和电子邮件两种方式发送报警信息
流量清洗 可以配置条件 1） ip吗每秒处理的报文数量（PPS） 2）每秒处理的流量值 （bps） 
ECS管理控制台可以进行阿里云的CPU利用率，出网入网流量的监控
云监控服务进行实例运行情况监控，并设置报警规则
* 云监控产品的监控数据可以采用（B 通过openAPI下载）
* 云监控http提交的指令是 （A post）
为ecs的系统盘做定期备份，可以使用快照
* DDoS的攻击类型包括 1：传输层 2：web应用层 3：畸形报文
* 调整DDos防护阙值并不会导致服务中断

每个交换机的第一个和最后三个ip为系统保留地址
因为业务需要缩短快照的制作时间，可以选择（B 本地快照） ， 快速，秒级别
同一地域下的不同可用区相距（A 数百米）
实人认证服务目前仅支持 （B 中华人民共和国二代身份证）
弹性公网IP是可以购买及持有的资源  （A RDS不支持绑定到EIP上）
智能DNS不具备网页缓存功能
* 阿里云盾的补丁通常来自于（A 阿里云自己研发）
* 阿里云盾数据风控，对于web系统可以用（A javascript方式）进行采集
* 防止本地ip频繁访问阿里云而被屏蔽的情况，可以通过云盾设置（A ip白名单）
* 云盾加密服务的密钥是由（B 客户） 负责保管的

* 希望将用户的访问重定向到https，最简单的实现方式是 （B 配置一个新的监听，并开启监听转发功能）


