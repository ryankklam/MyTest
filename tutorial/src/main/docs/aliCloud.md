# Ali Cloud

##SLB - Server Load Balancer 

1. server certificate 一次只能上传一份服务器证书及对应的私钥

####SLB功能架构
1. Load Balancer - 代表SLB实例
2. Listener - 代表定制的策略和转发规则
3. Backend Server - 后端的一组云服务器

####SLB基础架构
1. 四层负载均衡 - TCP/UDP
2. 七层负载均衡 - http/https
3. 控制系统 - 配置/监控 负载均衡系统

####SLB主要功能
1. 四层负载均衡/七层负载均衡 - 支持公网及私网（私网免费使用）
2. 健康检查 - 屏蔽不健康的实例，待实例恢复正常解除屏蔽
3. 会话保持 - session生命周期内，统一客户端的请求都转发到同一ECS
4. 转发方式 - 轮询（依次发送）/加权轮询（可为后端ecs设置权重）/加权最小连接数（请求转发到连接数最少的ecs） / 一致性哈希（源IP-相同的原地址会指向同一ECS/四元组-源IP，目的ip，源端口，目标端口，相同的流会指向同一ECS）
5. 证书管理 - https的证书解密放在SLB上，降低ECS的开销
6. 带宽控制 - 根据监听设置对应服务的带宽峰值
7. 容灾 - 支持同一地域（region）跨可用区容灾，结合DNS轮询支持跨地域的容灾
8. 控制方式 - 控制台/api/sdk

####SLB费用
1. 计费模式 - 预付费（按带宽，只支持升级,不支持降级或者释放）/后付费 （按固定带宽/按流量），可随时释放
2. 总费用 - 实例配置费 + 公网带宽费
3. 公网SLB和ECS之间的流量费 - 不收取费用

####监听概述
#####TCP监听
1. 面向连接的协议，在正式收发数据前，必须和对方建立可靠的连接
2. 基于源地址的会话保持
3. 在网络层可直接看到来源地址
4. 数据传输快
5. 适用于注重可靠性，对数据准确性要求高，速度可以相对较慢的场景，如文件传输、发送或接收邮件、远程登录
6. 无特殊要求的Web应用 （web应用都是基于http/https的）
7. TCP监听 - 支持tcp及http两种方式进行健康检查
8. 只有TCP/UDP监听支持添加主备服务器组

#####UDP
1. 面向非连接的协议，在数据发送前不与对方进行三次握手，直接进行数据包发送，不提供差错恢复和数据重传 
2. 可靠性相对低；数据传输快
3. 关注实时性而相对不注重可靠性的场景，如视频聊天、金融实时行情推送

#####HTTP
1. 应用层协议，主要解决如何包装数据
2. 基于Cookie的会话保持
3. 使用X-Forward-For获取源地址
4. 需要对数据内容进行识别的应用，如Web应用、小的手机游戏等。

#####HTTPS
1. 加密传输数据，可以阻止未经授权的访问
2. 统一的证书管理服务，用户可以将证书上传到负载均衡，解密操作直接在负载均衡上完成
3. 需要加密传输的应用。

#####SLB监听超时时间
1. TCP - 900秒
2. UDP - 90秒
3. HTTP - 60秒
4. HTTPS - 60秒


##ECS - Elastic Compute Service 
* ECS支持切换交换机 但不支持切换路由器
* ECS上停止是走正常关机流程，而强制停止则等于断电处理，可能会丢失信息
* ECS管理控制台直接支持的功能不包括 迁移实例
* ECS在更换系统盘的时候，镜像是可以修改的
* ECS转备用状态，则负载均衡不会有流量到，弹性伸缩不会检查此ecs，但也不会释放这个ecs
* ECS转保护状态，则弹性伸缩不会移除这个ECS，负载均衡权重不变（有流量到），弹性伸缩页不会检查此ecs，但也不会释放这个ecs
* VNC方式登录 1：实例自检原因导致启动速度慢 2：误操作开启了防火墙 3：ecs cpu带宽消耗高
* ecs部署sql server，因为windows的单通道i/o特性，最推荐使用是（C. ESSD云盘）
* 更换系统盘后，旧系统盘会被释放，系统盘id会更新，自动快照策略不一定失效
* 扩容系统盘需要ECS停机，但不会导致实力IP的变化
* 查看某个区域所有可用的ecs的实例步骤包括 （B{a,c,b}  进入管理控制台/选择ecs实例管理/选择地域）

查看某个区域所拥有的ecs实例
1. 进入ecs控制台
2. 选择ecs实例管理
3. 选择地域



##OSS

* 单个object的大小为48.8TB , 每个bucket的容量无上限
* oss域名绑定（CNAME）仅支持3级域名 （bucket name）。（region）。aliyuncs。com
* 域名绑定必须在工信部备案，不是在阿里云备案
* oss提供3重备份(每份数据备份三个副本)，出故障时自动恢复
* Bucket属性设置 1) 防盗链 2)自定义域名绑定 3) 读写权限（ACL）设置
* OSS的问题不支持修改
* CDN缓存刷新 1）目录刷新 2）URL预热 3） URL刷新
* 将bucket设置成静态网页托管模式后，对静态网站域名的匿名访问 oss将返回索引页；对静态网站根域名的访问 oss将返回GetBucket结果
* OSS同城冗余能够提供机房级别的容灾能力
* OSS低频访问类型存放是平均每月访问1-2次的数据，归档存储类型是放每年访问1-2次的数据
* OSS开启原图保护后，匿名访问不了，但通过CDN的请求可能可以访问（答案选CDN）
* OSS传输和加速服务，可以提升多地域上传速度 （CDN仅加速下载）（答案选A 开启OSS传输和加速服务）
* OSS图片样式，多参数之间用正斜线(/)连接 - 答案选B
* Object的权限大于Bucket的权限 - 若bucket访问私有，object是公共读写，那么 (A.所有用户都有该object的读写权限)
* Bucket自动生成包含日期的object，最可能的原因是 （C. bucket开启了日志存储）
* 公司限制员工只能访问某个指定的公网IP，但oss的bucket访问ip会随时变换，建议其采用 （B. 在ecs配置反向代理）
* 以下不属于精准防护的字段是 （D. Source-address）
* OSS的基本单位是object，object包含key/meta/data,不包含那个元素（B - id）
* OSS基于（A 纠错码）技术的冗余机制，确保硬件丢失时的可靠性可用性
* CDN加速访问url时，页面空白，用开发者工具查看ContentLength为0 ， 原因是 （D 查看源站是否返回了 transferEncoding： chunked 信息，CDN不支持此信息）


##VPC
* 只有两种状态 available （创建成功）/running （配置中）
* 服务器迁移到同vpc下的同一交换机步骤 （C 1，3，2，4）  打开控制台/选择所需交换机并指定新ip/找需要迁移的ecs/指定ecs的私网地址
* ecsAPI 网址 ecs.aliyuncs.com
* 不能开启networkmanager服务
* ecs api默认返回格式为xml
* VPC中的ECS不能与经典网络的ecs实现高速通信
* 某个VPC的网络附加ipv4是172.16.0.0/16，那么该vpc的交换机可选网段为172.16.0.0/17 - 172.16.0.0/29
* 网络ACL的规则是无状态的
* 网络ACL无任何规则时，拒绝所有出入访问 （D）、
* 硅谷和上海分别设置VPC1/VPC2，现想全互通（日流量100m），最高效经济是（B 使用vpn连接办公地点与所在VPC，将两个vpc加载到同一个云企业网）
* VPC默认是没有公网服务的，若想使vpc与公网联通，可以选择 （B. NAT网关）
* ipv6配置顺序 分配IPv6地址/开通网络带宽/配置v6地址/添加安全组规则 （B 2-1-4-3）
* 使用隧道封装技术对云服务的ip报文进行封装，所有云服务器的 （B 数据链路层 即二层mac地址） 信息不会进入物理网络，实现了不同云服务器之间的网络隔离
* 希望VPC下的ECS通过内网访问OSS，但是连接oss-cn-beijing-internal。aliyuncs.com失败，则 （A 只能通过外网访问）
* 安全组内网络隔离是网卡之间的隔离，不是ecs之间的隔离

##ESS弹性伸缩
* 如果伸缩组里的ecs不在运行状态，则会被自动移除，同时自动创建一个新的ecs加入到伸缩组
* 伸缩组包含 1）伸缩配置 2）伸缩规则 3） 伸缩活动
* 伸缩规则定义了具体的扩展或收缩工作 如 （A 加入或移除3个云服务的ECS实例）
* 使用伸缩组内的实例配置信息自动创建ECS，实力配置信息支持实例的规格，用户自定义数据及 （A 操作系统）
* 伸缩活动不可中断
* 在冷却时间内，伸缩组会拒绝由云监控发起的伸缩活动请求，对其他的类型的任务则会立即执行，绕过冷却时间
* 弹性伸缩生命周期挂钩支持的配置方式不包括OSS主板 
* 假设在某一时间点，定时任务和报警任务同时满足执行条件，以下说法正确的是 （B 同时只会有一个伸缩任务执行，两种任务并没有优先级之分）
* 弹性伸缩不依赖任何其他产品



##Points

交换机（VSwitch）不支持组播和广播


某个VPC的网络附加ipv4是172.16.0.0/16，那么该vpc的交换机可选网段为172.16.0.0/17 - 172.16.0.0/29
网络ACL的规则是无状态的
网络ACL无任何规则时，拒绝所有出入访问 （D）
SLB后端的ecs操作系统不一定需要一致
CDN实际产生的流量比应用层统计到的要高。是两个原因 1： TCP/IP的包头的消耗 2：TCP重传
创建EIP之后，云监控服务自动开启

公网分发请求到SLB的方法 1：购买公网ip的负载均衡SLB实例接受公网请求 2：创建VPC内的负载均衡实例，然后给这个SLB绑定EIP来接收公网请求
安全管家 支持人工安全技术支持，托管报告服务
* 安骑士 可以检测并修复漏洞
* 安装安骑士客户端后，用（A 管理控制台生成的安装验证key 方式与指定的阿里云账号互联）
云盾DDos是保障ECS/SLB/WAF/VPC/EIP/NAT云产品的网络安全，并不包括RDS/OSS
阿里云会保存SSH key的公钥部分
弹性公网IP（EIP）秒级监控

SLB的虚拟服务器组如果添加了该ecs，该ecs从经典网络迁移到vpc时，实例不会自动挂载
本地盘，很多操作都不行

HTTPDNS主要用在客户端防止url域名挟持
云态势感知，可以通过手机短讯和电子邮件两种方式发送报警信息
流量清洗 可以配置条件 1） ip吗每秒处理的报文数量（PPS） 2）每秒处理的流量值 （bps） 
ECS管理控制台可以进行阿里云的CPU利用率，出网入网流量的监控
云监控服务进行实例运行情况监控，并设置报警规则
为ecs的系统盘做定期备份，可以使用快照
* DDoS的攻击类型包括 1：传输层 2：web应用层 3：畸形报文
* 调整DDos防护阙值并不会导致服务中断

每个交换机的第一个和最后三个ip为系统保留地址
本地快照
同一地域下的不同可用区相距（A 数百米）
实人认证服务目前仅支持 （B 中华人民共和国二代身份证）
弹性公网IP是可以购买及持有的资源  （A RDS不支持绑定到EIP上）
智能DNS不具备网页缓存功能
阿里云盾的补丁通常来自于（A 阿里云自己研发）
阿里云盾数据风控，对于web系统可以用（A javascript方式）进行采集
* 希望将用户的访问重定向到https，最简单的实现方式是 （B 配置一个新的监听，并开启监听转发功能）


